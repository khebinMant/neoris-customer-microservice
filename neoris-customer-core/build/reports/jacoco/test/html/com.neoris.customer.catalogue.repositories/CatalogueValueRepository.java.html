<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CatalogueValueRepository.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">neoris-customer-core</a> &gt; <a href="index.source.html" class="el_package">com.neoris.customer.catalogue.repositories</a> &gt; <span class="el_source">CatalogueValueRepository.java</span></div><h1>CatalogueValueRepository.java</h1><pre class="source lang-java linenums">package com.neoris.customer.catalogue.repositories;

import com.neoris.customer.catalogue.entities.CatalogueValueEntity;
import com.neoris.customer.catalogue.entities.QCatalogueTypeEntity;
import com.neoris.customer.catalogue.entities.QCatalogueValueEntity;
import com.neoris.customer.catalogue.vo.CatalogueType.QueryCatalogueValue;
import com.neoris.customer.catalogue.vo.CatalogueValue.CatalogueValueVo;
import com.neoris.customer.catalogue.vo.CatalogueValue.CreateCatalogueValue;
import com.neoris.customer.catalogue.vo.CatalogueValue.UpdateCatalogueValue;
import com.neoris.customer.common.repositories.JPAQueryDslBaseRepository;
import com.neoris.customer.common.enums.Status;
import com.querydsl.core.BooleanBuilder;
import com.querydsl.core.types.Predicate;
import com.querydsl.core.types.Projections;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Repository;

import java.util.List;

import static com.querydsl.core.types.Projections.bean;

/**
 * {@inheritDoc}
 */
@Lazy
@Repository
public class CatalogueValueRepository extends JPAQueryDslBaseRepository&lt;CatalogueValueEntity&gt; implements ICatalogueValueRepository{

    public CatalogueValueRepository() {
<span class="nc" id="L30">        super(CatalogueValueEntity.class);</span>
<span class="nc" id="L31">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public CatalogueValueEntity create(Long catalogueTypeId, CreateCatalogueValue createCatalogueValue) {
<span class="nc" id="L38">        CatalogueValueEntity entity =  CatalogueValueEntity.builder()</span>
<span class="nc" id="L39">            .catalogueTypeId(catalogueTypeId)</span>
<span class="nc" id="L40">            .code(createCatalogueValue.getCode())</span>
<span class="nc" id="L41">            .name(createCatalogueValue.getName())</span>
<span class="nc" id="L42">            .description(createCatalogueValue.getDescription())</span>
<span class="nc" id="L43">            .placement(createCatalogueValue.getOrder())</span>
<span class="nc" id="L44">            .isDefault(createCatalogueValue.getIsDefault())</span>
<span class="nc" id="L45">            .build();</span>
<span class="nc" id="L46">        this.save(entity);</span>
<span class="nc" id="L47">        return entity;</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public CatalogueValueEntity findById(Long catalogueValueId) {
<span class="nc" id="L55">        return from(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L56">            .select(bean(CatalogueValueEntity.class, QCatalogueValueEntity.catalogueValueEntity.catalogueValueId, QCatalogueValueEntity.catalogueValueEntity.code, QCatalogueValueEntity.catalogueValueEntity.name, QCatalogueValueEntity.catalogueValueEntity.description))</span>
<span class="nc" id="L57">            .where(this.activeCatalogueCondition(catalogueValueId))</span>
<span class="nc" id="L58">            .fetchFirst();</span>
    }

    @Override
    public CatalogueValueEntity findByCode(String code) {
<span class="nc" id="L63">        return from(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L64">            .where(QCatalogueValueEntity.catalogueValueEntity.code.eq(code))</span>
<span class="nc" id="L65">            .fetchFirst();</span>
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public void updateEntity(Long catalogueValueId, UpdateCatalogueValue updateCatalogueValue) {
<span class="nc" id="L73">        this.update(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L74">            .where(this.activeCatalogueCondition(catalogueValueId))</span>
<span class="nc" id="L75">            .set(QCatalogueValueEntity.catalogueValueEntity.name, updateCatalogueValue.getName())</span>
<span class="nc" id="L76">            .set(QCatalogueValueEntity.catalogueValueEntity.description, updateCatalogueValue.getDescription())</span>
<span class="nc" id="L77">            .set(QCatalogueValueEntity.catalogueValueEntity.placement, updateCatalogueValue.getPlacement())</span>
<span class="nc" id="L78">            .set(QCatalogueValueEntity.catalogueValueEntity.isDefault, updateCatalogueValue.getIsDefault())</span>
<span class="nc" id="L79">            .execute();</span>
<span class="nc" id="L80">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public void inactive(Long catalogueValueId) {
<span class="nc" id="L87">        this.update(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L88">            .where(this.activeCatalogueCondition(catalogueValueId))</span>
<span class="nc" id="L89">            .set(QCatalogueValueEntity.catalogueValueEntity.status, Status.INACTIVE.value)</span>
<span class="nc" id="L90">            .execute();</span>
<span class="nc" id="L91">    }</span>

    /**
     * {@inheritDoc}
     */
    @Override
    public List&lt;CatalogueValueEntity&gt; findAll(QueryCatalogueValue query) {
<span class="nc" id="L98">        return from(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L99">            .where(buildQuery(query))</span>
<span class="nc" id="L100">            .orderBy(QCatalogueValueEntity.catalogueValueEntity.placement.asc())</span>
<span class="nc" id="L101">            .fetch();</span>
    }

    /**
     * Condition for active catalogue value
     *
     * @param catalogueValueId Id of catalogue
     * @return Condition
     */
    private BooleanBuilder activeCatalogueCondition(Long catalogueValueId) {
<span class="nc" id="L111">        BooleanBuilder where = new BooleanBuilder();</span>
<span class="nc" id="L112">        where.and(QCatalogueValueEntity.catalogueValueEntity.catalogueValueId.eq(catalogueValueId));</span>
<span class="nc" id="L113">        where.and(statusPredicate(Status.ACTIVE));</span>
<span class="nc" id="L114">        return where;</span>
    }

    /**
     * Status predicate
     *
     * @param status Status
     * @return Predicate
     */
    private Predicate statusPredicate(Status status) {
<span class="nc" id="L124">        return QCatalogueValueEntity.catalogueValueEntity.status.eq(status.value);</span>
    }

    /**
     * Builder query
     *
     * @param query Query
     * @return Builder boolean query
     */
    private BooleanBuilder buildQuery(QueryCatalogueValue query) {
<span class="nc" id="L134">        BooleanBuilder where = new BooleanBuilder();</span>

        // Add status active condition
<span class="nc" id="L137">        where.and(QCatalogueValueEntity.catalogueValueEntity.status.eq(Status.ACTIVE.value));</span>

        // Filter by catalogueTypeId
<span class="nc bnc" id="L140" title="All 2 branches missed.">        if (query.getCatalogueTypeId() != null) {</span>
<span class="nc" id="L141">            where.and(QCatalogueValueEntity.catalogueValueEntity.catalogueTypeId.eq(query.getCatalogueTypeId()));</span>
        }

<span class="nc" id="L144">        return where;</span>
    }

    /**
     * Builder query
     *
     * @param code String
     * @return List of Catalogs
     */
    public List&lt;CatalogueValueVo&gt; findAllByCode(String code){
<span class="nc" id="L154">        return from(QCatalogueValueEntity.catalogueValueEntity)</span>
<span class="nc" id="L155">                .leftJoin(QCatalogueTypeEntity.catalogueTypeEntity).on(QCatalogueValueEntity.catalogueValueEntity.catalogueTypeId.eq(QCatalogueTypeEntity.catalogueTypeEntity.catalogueTypeId))</span>
<span class="nc" id="L156">                .where(QCatalogueTypeEntity.catalogueTypeEntity.code.eq(code))</span>
<span class="nc" id="L157">                .select(Projections.bean(CatalogueValueVo.class,</span>
                    QCatalogueValueEntity.catalogueValueEntity.catalogueValueId,
                    QCatalogueValueEntity.catalogueValueEntity.code,
                    QCatalogueValueEntity.catalogueValueEntity.name))
<span class="nc" id="L161">                .orderBy(QCatalogueValueEntity.catalogueValueEntity.placement.asc())</span>
<span class="nc" id="L162">                .fetch();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>